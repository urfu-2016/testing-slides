<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Unit</title>

    <link rel="stylesheet" href="../css/reveal.css">
    <link rel="stylesheet" href="../css/theme/yandex.css">
    <link rel="stylesheet" href="./css/user.css">
    <link rel="stylesheet" href="../css/zenburn.css">
</head>
<body>
<div class="reveal"><div class="slides">

<section>
    <h1>Автотесты</h1>
    <p>Assert. Unit tests. Mocha</p>
    <p class="author">Жигалов Сергей</p>
</section>

<section>
    <section>
        <blockquote>
            «До окончания операции осталось 41 секунд»
        </blockquote>
    </section>

    <section>
        <h3>Задача</h3>
        <blockquote>
            Выбрать правильную форму склонения числительного
        </blockquote>
    </section>

    <section>
        <h3><span class="gray">Задача.</span> Пример</h3>
        <ul>
            <li>1 монета</li>
            <li>2 монеты</li>
            <li>5 монет</li>
        </ul>
    </section>

    <section>
        <h3><span class="gray">Задача.</span> Пример</h3>
        <pre class="js"><code data-trim>
const forms = ['монета', 'монеты', 'монет'];

getPlural(1, forms); // 'монета'
getPlural(2, forms); // 'монеты'
getPlural(5, forms); // 'монет'
        </code></pre>
    </section>

    <section>
        <h3><span class="gray">Задача.</span> Наблюдения</h3>
        <pre class="js"><code data-trim>
const forms = ['монета', 'монеты', 'монет'];
        </code></pre>
        <ul>
            <li>Заканчивается на <code>1</code>, то <code>forms[0]</code></li>
            <li>Заканчивается на <code>2 - 4</code>, то <code>forms[1]</code></li>
            <li>Заканчивается на <code>0, 5 - 9</code>, то <code>forms[2]</code></li>
            <li>Заканчивается на <code>11 - 14</code>, то <code>forms[2]</code></li>
        </ul>
    </section>

    <section>
        <h3><span class="gray">Задача.</span> Алгоритм</h3>
        <ol>
            <li>Для <code>11-14</code> вернуть <code>forms[2]</code></li>
            <li>Взять остаток от деления на <code>10</code></li>
            <li>Для <code>1</code> вернуть <code>forms[0]</code></li>
            <li>Для <code>2-4</code> вернуть <code>forms[1]</code></li>
            <li>Для <code>0, 5-9</code> вернуть <code>forms[2]</code></li>
        </ol>
    </section>

    <section>
        <h3><span class="gray">Задача.</span> Код</h3>
        <pre class="js"><code data-trim>
function getPlural(count, forms) {
    if (count > 10 && count < 15)
        return forms[2];

    const residue = count % 10;

    if (residue === 1)
        return forms[0];
    if (residue > 0 && residue < 5)
        return forms[1];
    return forms[2];
}
        </code></pre>
    </section>

    <section>
        <h3><span class="gray">Задача.</span> Проверяем</h3>

        <pre class="js"><code data-trim>
const forms = ['монета', 'монеты', 'монет'];

getPlural(1, forms); // 'монета'
getPlural(2, forms); // 'монеты'
getPlural(5, forms); // 'монет'
getPlural(11, forms); // 'монет'
getPlural(22, forms); // 'монеты'
        </code></pre>
    </section>

    <section>
        <h3><span class="gray">Задача.</span> Проверяем</h3>

        <pre class="js"><code data-trim>
const forms = ['монета', 'монеты', 'монет'];

getPlural(1, forms) === 'монета';  // true
getPlural(2, forms) === 'монеты';  // true
getPlural(5, forms) === 'монет';   // true
getPlural(11, forms) === 'монет';  // true
getPlural(22, forms) === 'монеты'; // true
        </code></pre>
    </section>
</section>

<section>
    <section>
        <h3><code>assert(value[, message])</code></h3>
    </section>

    <section>
        <pre class="js"><code data-trim>
function assert(value) {
    if (!value) {
        throw new Error('Assertion failed');
    }
}
        </code></pre>
    </section>

    <section>
        <h3><span class="gray">assert</span> success</h3>
        <pre class="js"><code data-trim>
const assert = require('assert');
const forms = ['монета', 'монеты', 'монет'];

assert(getPlural(1, forms) === 'монета');
        </code></pre>
        <pre class="js console"><code>
        </code></pre>
    </section>

    <section>
        <h3><span class="gray">assert</span> error</h3>
        <pre class="js"><code data-trim>
const assert = require('assert');
const forms = ['монета', 'монеты', 'монет'];

assert(getPlural(1, forms) === 'монет');
        </code></pre>
        <pre class="js console"><code data-trim>
assert.js:89
  throw new assert.AssertionError({
  ^
AssertionError: false == true
    at Object.&lt;anonymous&gt; (/plural.js:17:1)
        </code></pre>
    </section>

    <section>
        <h3><span class="gray">assert</span> message</h3>
        <pre class="js"><code data-trim>
const assert = require('assert');
const forms = ['монета', 'монеты', 'монет'];

assert(
    getPlural(1, forms) === 'монета',
    'Должен вернуть `монета` если передать `1`');
        </code></pre>
        <pre class="js console fragment"><code data-trim>
assert.js:89
  throw new assert.AssertionError({
  ^
AssertionError: Должен вернуть `монета` если передать `1`
    at Object.&lt;anonymous&gt; (/plural.js:17:1)
        </code></pre>
    </section>

    <section>
        <h3><span class="gray">assert</span> equal</h3>
        <pre class="js"><code data-trim>
const assert = require('assert');
const forms = ['монета', 'монеты', 'монет'];

assert.equal(getPlural(1, forms), 'монет');
        </code></pre>
        <pre class="js console fragment"><code data-trim>
assert.js:89
  throw new assert.AssertionError({
  ^
AssertionError: 'монета' == 'монет'
    at Object.&lt;anonymous&gt; (/plural.js:17:8)
        </code></pre>
    </section>

    <section>
        <h3><span class="gray">assert</span> итог</h3>
        <ul>
            <li class="fragment">Проверяет данные</li>
            <li class="fragment">Локализует ошибки</li>
            <li class="fragment">Используется в коде</li>
            <li class="fragment">Никак не влияет в случае успеха</li>
        </ul>
    </section>
</section>

<section>
    <section>
        <h3><span class="gray">Задача.</span> Проверяем</h3>

        <pre class="js"><code data-trim>
const assert = require('assert');
const forms = ['монета', 'монеты', 'монет'];

assert.equal(getPlural(1, forms), 'монета');
assert.equal(getPlural(2, forms), 'монеты');
assert.equal(getPlural(5, forms), 'монет');
assert.equal(getPlural(11, forms), 'монет');
assert.equal(getPlural(22, forms), 'монеты');
        </code></pre>
        <pre class="js fragment"><code data-trim>
assert.equal(getPlural(113, forms), 'монет');
        </code></pre>
        <pre class="js console fragment"><code data-trim>
assert.js:89
  throw new assert.AssertionError({
  ^
AssertionError: 'монеты' == 'монет'
    at Object.&lt;anonymous&gt; (/plural.js:22:8)
        </code></pre>
    </section>

    <section>
        <h3><span class="gray">Задача.</span> Алгоритм</h3>
        <ol>
            <li>Для <code>11-14</code> вернуть <code>forms[2]</code></li>
            <li>Взять остаток от деления на <code>10</code></li>
            <li>Для <code>1</code> вернуть <code>forms[0]</code></li>
            <li>Для <code>2-4</code> вернуть <code>forms[1]</code></li>
            <li>Для <code>0, 5-9</code> вернуть <code>forms[2]</code></li>
        </ol>
    </section>

    <section>
        <h3><span class="gray">Задача.</span> Исправляем</h3>

        <pre class="js"><code data-trim data-noescape>
function getPlural(count, forms) {
    <span class="fragment grow">count %= 100;</span>
    if (count > 10 && count < 15)
        return forms[2];

    const residue = count % 10;
    if (residue === 1)
        return forms[0];
    if (residue > 0 && residue < 5)
        return forms[1];

    return forms[2];
}
        </code></pre>
    </section>
</section>

<section>
    <section>
        <blockquote>
            Я ответственный разработчик.
            Думаю прежде чем писать код.
        </blockquote>
        <div class="fragment">
            <h3>Тесты?</h3>
            <img src="images/plakat-net.jpg" alt="No">
        </div>
    </section>

    <section>
        <h3>Для чего нужны тесты?</h3>
        <ul>
            <li class="fragment">Код работает</li>
            <li class="fragment">Вносить изменения</li>
            <li class="fragment">Рефакторить</li>
            <li class="fragment">Живая документация</li>
            <li class="fragment">Локализация ошибки</li>
            <li class="fragment">Структура кода</li>
        </ul>
        <aside class="notes">
Упрощение кода - если код покрыт юнит тестами, значит он хорошо декомпозирован на части, а значит простой
        </aside>
    </section>
</section>

<section>
    <section data-background-image="images/mochajs.png" data-background-size=auto>
    </section>

    <section>
        <h3><span class="gray">mocha</span> установка</h3>
        <pre class="bash"><code data-trim>
npm install mocha --save-dev
        </code></pre>
        <pre class="js fragment"><code data-trim>
// package.json
{
    "devDependencies": {
        "mocha": "3.2.0"
    }
}
        </code></pre>
    </section>

    <section>
        <h3><span class="gray">mocha</span> подготовка</h3>
        <pre class="js"><code data-trim>
// tests/plural-test.js

describe('getPlural', () => {
    it('should return `монета` for `1`');
    it('should return `монеты` for `2`');
    it('should return `монет` for `5`');
    it('should return `монет` for `11`');
    it('should return `монеты` for `22`');
    it('should return `монет` for `113`');
});
        </code></pre>
        <aside class="notes">
1. помещаем всё в папку tests
2. к файлу дописываем суффикс `-test.js`
3. описываем что тестируем
4. описываем поведение
        </aside>
    </section>

    <section>
        <h3><span class="gray">mocha</span> запуск</h3>
        <pre class="bash"><code data-trim>
node_modules/.bin/mocha tests
        </code></pre>
        <pre class="no console"><code data-trim>
getPlural
  - should return `монета` for `1`
  - should return `монеты` for `2`
  - should return `монет` for `5`
  - should return `монет` for `11`
  - should return `монеты` for `22`
  - should return `монет` for `113`


0 passing (6ms)
6 pending
        </code></pre>
    </section>

    <section>
        <h3><span class="gray">mocha</span> тест</h3>
        <pre class="js size-S"><code data-trim>
// tests/plural-test.js
const getPlural = require('../plural.js')
const assert = require('assert');

describe('getPlural', () => {
    const forms = ['монета', 'монеты', 'монет'];

    it('should return `монета` for `1`', () => {
        const actual = getPlural(1, forms);

        assert.equal(actual, 'монета');
    });

    // ...
});
        </code></pre>
    </section>

    <section>
        <h3><span class="gray">mocha</span> запуск</h3>
        <pre class="bash"><code data-trim>
node_modules/.bin/mocha tests
        </code></pre>
        <pre class="no console"><code data-trim>
getPlural
  ✓ should return `монета` for `1`
  - should return `монеты` for `2`
  - should return `монет` for `5`
  - should return `монет` for `11`
  - should return `монеты` for `22`
  - should return `монет` for `113`


1 passing (7ms)
5 pending
        </code></pre>
    </section>

    <section>
        <h3><span class="gray">mocha</span> запуск</h3>
        <pre class="bash"><code data-trim>
node_modules/.bin/mocha tests
        </code></pre>
        <pre class="no console"><code data-trim>
getPlural
  ✓ should return `монета` for `1`
  ✓ should return `монеты` for `2`
  ✓ should return `монет` for `5`
  ✓ should return `монет` for `11`
  ✓ should return `монеты` for `22`
  ✓ should return `монет` for `113`


6 passing (9ms)
        </code></pre>
    </section>

    <section>
        <h3><span class="gray">mocha</span> запуск</h3>
        <pre class="js"><code data-trim>
// package.json
{
    "scripts": {
        "test": "mocha tests"
    }
}
        </code></pre>
        <pre class="js fragment"><code data-trim>
npm test
        </code></pre>
    </section>
</section>

<section>
    <h3>Почитать</h3>
    <ul>
        <li><a href="https://tproger.ru/translations/unit-tests-purposes/">Зачем нужны юнит-тесты</a></li>
        <li><a href="https://habrahabr.ru/post/141080/">Assert. Что это?</a></li>
        <li><a href="https://mochajs.org/">mocha</a></li>
    </ul>
</section>

</div></div>

<script src="../js/head.min.js"></script>
<script src="../js/reveal.js"></script>

<script>
// More info https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({
    controls: false,
    slideNumber: 'c',
    history: true,
    margin: 0,
    width: 960,
    height: 700,

    // More info https://github.com/hakimel/reveal.js#dependencies
    dependencies: [
        { src: '../plugin/notes/notes.js', async: true },
        { src: '../plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
    ]
});
</script>
</body>
</html>
